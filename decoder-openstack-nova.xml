<!-- DECODER UTAMA -->

<!-- nova-api -->
<decoder name="nova-api-log">
  <prematch type="pcre2">^nova-api\.log</prematch>
</decoder>

<decoder name="nova-api-log-http">
  <parent>nova-api-log</parent>
  <prematch type="pcre2">"(GET|POST|PUT|DELETE) .+ HTTP/[0-9\.]+"</prematch>
  <regex type="pcre2">\.([0-9]{4}-[0-9]{2}-[0-9]{2}_[0-9]{2}:[0-9]{2}:[0-9]{2}) ([0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}\.[0-9]{3}) (\d+) (INFO|WARNING|ERROR) ([\w\.]+) \[req-([a-f0-9\-]+)(?: [^\]]*)?\](?: ([0-9\.,]+))? "(GET|POST|PUT|DELETE) ([^ ]+) HTTP\/([0-9.]+)" status: (\d{3}) len: (\d+) time: ([0-9\.]+)</regex>
  <order>log_timestamp, event_timestamp, pid, log_level, module, request_id, srcip, http_method, http_path, http_version, http_status, http_len, httptime</order>
</decoder>

<decoder name="nova-api-log-detail">
  <parent>nova-api-log</parent>
  <regex type="pcre2">\.([0-9]{4}-[0-9]{2}-[0-9]{2}_[0-9]{2}:[0-9]{2}:[0-9]{2}) ([0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}\.[0-9]{3}) (\d+) (INFO|WARNING|ERROR) ([\w\.]+)(?: \[req-([a-f0-9\-]+)(?: [^\]]*)?\])?(?: \[instance: ([a-f0-9\-]+)\])?\s?(.+)?</regex>
  <order>log_timestamp, event_timestamp, pid, log_level, module, request_id, instanceid, message</order>
</decoder>

<!-- nova-compute -->
<decoder name="nova-computed-log">
  <prematch type="pcre2">^nova-compute\.log</prematch>
</decoder>

<decoder name="nova-compute-log-detail">
  <parent>nova-computed-log</parent>
  <regex type="pcre2">\.([0-9]{4}-[0-9]{2}-[0-9]{2}_[0-9]{2}:[0-9]{2}:[0-9]{2}) ([0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}\.[0-9]{3}) (\d+) (INFO|WARNING|ERROR) ([\w\.]+)(?: \[req-([a-f0-9\-]+)(?: [^\]]*)?\])?(?: \[instance: ([a-f0-9\-]+)\])?\s?(.+)?</regex>
  <order>log_timestamp, event_timestamp, pid, log_level, module, request_id, instanceid, message</order>
</decoder>

<!-- nova-scheduler -->
<decoder name="nova-scheduler-log">
  <prematch type="pcre2">^nova-scheduler\.log</prematch>
</decoder>

<decoder name="nova-scheduler-log-detail">
  <parent>nova-scheduler-log</parent>
  <regex type="pcre2">\.([0-9]{4}-[0-9]{2}-[0-9]{2}_[0-9]{2}:[0-9]{2}:[0-9]{2}) ([0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}\.[0-9]{3}) (\d+) (INFO|WARNING|ERROR) ([\w\.]+)(?: \[req-([a-f0-9\-]+)[^\]]*\])?\s?(.+)?</regex>
  <order>log_timestamp, event_timestamp, pid, log_level, module, request_id, message</order>
</decoder>
